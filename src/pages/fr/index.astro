---
import { getEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Hero from '../../components/Hero';
import ScrollReveal from '../../components/ScrollReveal';
import ParallaxBackground from '../../components/ParallaxBackground';
import AnimatedCounter from '../../components/AnimatedCounter';
import ProjectCard from '../../components/ProjectCard';
import frTranslations from '../../i18n/fr.json';
import { tSync } from '../../utils/i18n';

const translations = frTranslations;
const lang = 'fr' as const;

export const prerender = true;

// Charger les données dynamiques
const certsEntry = await getEntry('certifications', 'certifications.fr');
const skillsEntry = await getEntry('skills', 'skills.fr');
const allProjects = await getCollection('projects', ({ id }) => id.endsWith('.fr.mdx'));

const certs = certsEntry?.data ?? [];
const skills = skillsEntry?.data ?? [];
const totalSkills = skills.reduce((acc, cat) => acc + cat.skills.length, 0);

// Projets mis en avant (featured + tri par date)
const featuredProjects = allProjects
  .filter((p) => p.data.featured)
  .sort((a, b) => b.data.startDate.getTime() - a.data.startDate.getTime())
  .slice(0, 3);

const statusMap = {
  completed: 'production' as const,
  'in-progress': 'development' as const,
  planned: 'development' as const,
};
---

<Layout
  title="Portfolio Professionnel - Accueil"
  description="Portfolio d'Esdras GBEDOZIN — Ingénieur Full-Stack & Architecte Cloud. Projets, certifications et compétences techniques."
  lang={lang}
>
  <Hero
    client:idle
    title={tSync('hero.name', lang, translations)}
    tagline={tSync('hero.tagline', lang, translations)}
    description={tSync('hero.description', lang, translations)}
    primaryCta={{ label: tSync('hero.cta.projects', lang, translations), href: '/fr/projects' }}
    secondaryCta={{ label: tSync('hero.cta.contact', lang, translations), href: '/fr/contact' }}
  />

  {/* Stats Section */}
  <section class="py-16 bg-neutral-950/50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
        <AnimatedCounter
          end={allProjects.length}
          suffix="+"
          label="Projets"
          duration={2}
          client:idle
        />
        <AnimatedCounter end={certs.length} label="Certifications" duration={2} client:idle />
        <AnimatedCounter
          end={totalSkills}
          suffix="+"
          label="Technologies"
          duration={2.5}
          client:idle
        />
        <AnimatedCounter end={skills.length} label="Domaines" duration={2} client:idle />
      </div>
    </div>
  </section>

  {/* Featured Projects Section with Parallax */}
  <ParallaxBackground speed={0.3} variant="gradient" className="py-24" client:idle>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <ScrollReveal delay={0} client:idle>
        <h2
          class="text-4xl font-bold text-center mb-4 bg-gradient-to-r from-primary-400 to-purple-500 gradient-text"
        >
          Projets Phares
        </h2>
        <p class="text-center text-neutral-400 mb-12 max-w-2xl mx-auto">
          Découvrez mes réalisations récentes en développement web full-stack
        </p>
      </ScrollReveal>

      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-12">
        {
          featuredProjects.map((project, index) => {
            const startYear = project.data.startDate.getFullYear();
            const endYear = project.data.endDate ? project.data.endDate.getFullYear() : null;
            const period =
              endYear && endYear !== startYear ? `${startYear} - ${endYear}` : `${startYear}`;
            return (
              <ScrollReveal delay={100 + index * 150} client:idle>
                <ProjectCard
                  title={project.data.title}
                  description={project.data.description}
                  technologies={project.data.technologies.slice(0, 5)}
                  period={period}
                  status={statusMap[project.data.status]}
                  repositoryUrl={project.data.githubUrl}
                  demoUrl={project.data.liveUrl}
                  client:idle
                />
              </ScrollReveal>
            );
          })
        }
      </div>

      <ScrollReveal delay={500} client:idle>
        <div class="flex justify-center">
          <a
            href="/fr/projects"
            class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-500 text-white rounded-lg font-medium hover:from-primary-500 hover:to-primary-400 transition-all hover:scale-105 shadow-lg hover:shadow-primary-500/50"
          >
            Voir tous les projets
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </a>
        </div>
      </ScrollReveal>
    </div>
  </ParallaxBackground>

  {/* Skills Section with Grid Pattern */}
  <ParallaxBackground speed={0.2} variant="grid" className="py-24 bg-neutral-950/50" client:idle>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <ScrollReveal delay={0} client:idle>
        <h2
          class="text-4xl font-bold text-center mb-4 bg-gradient-to-r from-primary-400 to-purple-500 gradient-text"
        >
          Compétences Techniques
        </h2>
        <p class="text-center text-neutral-400 mb-12 max-w-2xl mx-auto">
          Technologies et outils que je maîtrise pour créer des solutions performantes
        </p>
      </ScrollReveal>

      {/* Skill categories preview */}
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-12">
        {
          skills.slice(0, 5).map((cat, index) => (
            <ScrollReveal delay={100 + index * 100} client:idle>
              <div class="glass-effect rounded-xl p-4 text-center hover:border-primary-400/20 border border-transparent transition-all duration-300">
                <p class="text-2xl font-bold text-neutral-100 mb-1">{cat.skills.length}</p>
                <p class="text-xs text-neutral-400 leading-tight">{cat.category}</p>
              </div>
            </ScrollReveal>
          ))
        }
      </div>

      <ScrollReveal delay={600} client:idle>
        <div class="flex justify-center">
          <a
            href="/fr/skills"
            class="inline-flex items-center gap-2 px-6 py-3 border-2 border-neutral-700 text-neutral-200 rounded-lg font-medium hover:bg-neutral-800/50 hover:border-primary-500 transition-all backdrop-blur-sm"
          >
            Explorer mes compétences
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
            </svg>
          </a>
        </div>
      </ScrollReveal>
    </div>
  </ParallaxBackground>
</Layout>
