---
/**
 * Page Projets FR
 * Epic 4.3 - FE-062: Intégrer getCollection dans page projets
 * Epic 5.2 - FE-073: Intégrer ProjectList avec filtres
 * Phase 1-4: Visual enhancements (parallax, scroll reveal)
 */
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import { ProjectList } from '../../../components/ProjectList';
import ScrollReveal from '../../../components/ScrollReveal';
import ParallaxBackground from '../../../components/ParallaxBackground';
import type { Project } from '../../../components/ProjectList';

export const prerender = true;

// Récupérer les projets FR depuis Content Collections
const allProjects = await getCollection('projects', ({ id }) => {
  return id.endsWith('.fr.mdx');
});

// Trier par date de début (plus récent en premier)
const sortedProjects = allProjects.sort((a, b) => {
  return b.data.startDate.getTime() - a.data.startDate.getTime();
});

// Transform to Project interface for ProjectList component
const projects: Project[] = sortedProjects.map((project) => {
  const startYear = project.data.startDate.getFullYear();
  const endYear = project.data.endDate ? project.data.endDate.getFullYear() : null;
  const period = endYear && endYear !== startYear ? `${startYear} - ${endYear}` : `${startYear}`;

  const statusMap = {
    completed: 'production' as const,
    'in-progress': 'development' as const,
    planned: 'development' as const,
  };

  return {
    title: project.data.title,
    description: project.data.description,
    technologies: project.data.technologies,
    category: project.data.category,
    period,
    status: statusMap[project.data.status],
    repositoryUrl: project.data.githubUrl,
    demoUrl: project.data.liveUrl,
  };
});
---

<Layout title="Mes Projets - Portfolio" lang="fr">
  <ParallaxBackground speed={0.3} variant="gradient" className="py-20" client:idle>
    <div class="container mx-auto px-4">
      <ScrollReveal delay={0} client:idle>
        <div class="text-center mb-16">
          <h1
            class="text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-primary-400 via-purple-500 to-primary-400 bg-clip-text text-transparent bg-[length:200%_100%] animate-gradient-text"
          >
            Mes Projets
          </h1>
          <p class="text-xl text-neutral-400 max-w-3xl mx-auto leading-relaxed">
            Découvrez mes réalisations techniques : applications web, architectures cloud, et
            solutions innovantes développées avec passion.
          </p>
        </div>
      </ScrollReveal>

      {/* ProjectList React Island with filters - FE-073 */}
      <ProjectList client:idle projects={projects} />
    </div>
  </ParallaxBackground>
</Layout>
