---
/**
 * Projects Page EN
 * Epic 4.3 - FE-062: Integrate getCollection in projects page
 * Epic 5.2 - FE-073: Integrate ProjectList with filters
 */
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import { ProjectList } from '../../../components/ProjectList';
import type { Project } from '../../../components/ProjectList';

export const prerender = true;

// Fetch EN projects from Content Collections
const allProjects = await getCollection('projects', ({ id }) => {
  return id.endsWith('.en.mdx');
});

// Sort by start date (most recent first)
const sortedProjects = allProjects.sort((a, b) => {
  return b.data.startDate.getTime() - a.data.startDate.getTime();
});

// Transform to Project interface for ProjectList component
const projects: Project[] = sortedProjects.map((project) => {
  const startYear = project.data.startDate.getFullYear();
  const endYear = project.data.endDate ? project.data.endDate.getFullYear() : null;
  const period = endYear && endYear !== startYear ? `${startYear} - ${endYear}` : `${startYear}`;

  const statusMap = {
    completed: 'production' as const,
    'in-progress': 'development' as const,
    planned: 'development' as const,
  };

  return {
    title: project.data.title,
    description: project.data.description,
    technologies: project.data.technologies,
    category: project.data.category,
    period,
    status: statusMap[project.data.status],
    repositoryUrl: project.data.githubUrl,
    demoUrl: project.data.liveUrl,
  };
});
---

<Layout title="My Projects - Portfolio" lang="en">
  <div class="container mx-auto px-4 py-16">
    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">My Projects</h1>
      <p class="text-lg text-[var(--color-neutral-400)] max-w-2xl mx-auto">
        Discover my technical achievements: web applications, cloud architectures, and innovative
        solutions built with passion.
      </p>
    </div>

    {/* ProjectList React Island with filters - FE-073 */}
    <ProjectList client:idle projects={projects} />
  </div>
</Layout>
