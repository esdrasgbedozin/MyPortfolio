---
import { getEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Hero from '../../components/Hero';
import ScrollReveal from '../../components/ScrollReveal';
import ParallaxBackground from '../../components/ParallaxBackground';
import AnimatedCounter from '../../components/AnimatedCounter';
import ProjectCard from '../../components/ProjectCard';
import InfiniteMarquee from '../../components/InfiniteMarquee';
import TextReveal from '../../components/TextReveal';
import enTranslations from '../../i18n/en.json';
import { tSync } from '../../utils/i18n';

const translations = enTranslations;
const lang = 'en' as const;

export const prerender = true;

// Load dynamic data
const certsEntry = await getEntry('certifications', 'certifications.en');
const skillsEntry = await getEntry('skills', 'skills.en');
const allProjects = await getCollection('projects', ({ id }) => id.endsWith('.en.mdx'));

const certs = certsEntry?.data ?? [];
const skills = skillsEntry?.data ?? [];
const totalSkills = skills.reduce((acc, cat) => acc + cat.skills.length, 0);

// Featured projects (sorted by date)
const featuredProjects = allProjects
  .filter((p) => p.data.featured)
  .sort((a, b) => b.data.startDate.getTime() - a.data.startDate.getTime())
  .slice(0, 3);

const statusMap = {
  completed: 'production' as const,
  'in-progress': 'development' as const,
  planned: 'development' as const,
};
---

<Layout
  title="Professional Portfolio - Home"
  description="Esdras GBEDOZIN's Portfolio â€” Full-Stack Engineer & Cloud Architect. Projects, certifications and technical skills."
  lang={lang}
>
  {/* Hero with floating orbs */}
  <div class="relative">
    <div class="floating-orbs" aria-hidden="true">
      <div class="orb orb-1"></div>
      <div class="orb orb-2"></div>
      <div class="orb orb-3"></div>
    </div>
    <Hero
      client:idle
      title={tSync('hero.name', lang, translations)}
      tagline={tSync('hero.tagline', lang, translations)}
      description={tSync('hero.description', lang, translations)}
      primaryCta={{ label: tSync('hero.cta.projects', lang, translations), href: '/en/projects' }}
      secondaryCta={{ label: tSync('hero.cta.contact', lang, translations), href: '/en/contact' }}
    />
  </div>

  {/* Tech Marquee â€” infinite scrolling tech stack */}
  <section class="py-6 border-y border-neutral-800/50 bg-neutral-950/80 overflow-hidden">
    <InfiniteMarquee
      items={[
        { label: 'React', icon: 'âš›ï¸' },
        { label: 'TypeScript', icon: 'ðŸ”·' },
        { label: 'Python', icon: 'ðŸ' },
        { label: 'Astro', icon: 'ðŸš€' },
        { label: 'Docker', icon: 'ðŸ³' },
        { label: 'GCP', icon: 'â˜ï¸' },
        { label: 'Node.js', icon: 'ðŸ’š' },
        { label: 'Jenkins', icon: 'âš™ï¸' },
        { label: 'Tailwind CSS', icon: 'ðŸŽ¨' },
        { label: 'PostgreSQL', icon: 'ðŸ˜' },
        { label: 'Terraform', icon: 'ðŸ—ï¸' },
        { label: 'FastAPI', icon: 'âš¡' },
        { label: 'Git', icon: 'ðŸ“' },
        { label: 'SAP HANA', icon: 'ðŸ’Ž' },
      ]}
      speed={35}
      client:idle
    />
  </section>

  {/* Stats Section */}
  <section class="py-16 bg-neutral-950/50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
        <AnimatedCounter
          end={allProjects.length}
          suffix="+"
          label="Projects"
          duration={2}
          client:idle
        />
        <AnimatedCounter end={certs.length} label="Certifications" duration={2} client:idle />
        <AnimatedCounter
          end={totalSkills}
          suffix="+"
          label="Technologies"
          duration={2.5}
          client:idle
        />
        <AnimatedCounter end={skills.length} label="Domains" duration={2} client:idle />
      </div>
    </div>
  </section>

  {/* Featured Projects Section with Parallax */}
  <ParallaxBackground speed={0.3} variant="gradient" className="py-24" client:idle>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <ScrollReveal delay={0} client:idle>
        <h2
          class="text-4xl font-bold text-center mb-4 bg-gradient-to-r from-primary-400 to-purple-500 gradient-text"
        >
          Featured Projects
        </h2>
        <p class="text-center text-neutral-400 mb-12 max-w-2xl mx-auto">
          Discover my recent achievements in full-stack web development
        </p>
      </ScrollReveal>

      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-12">
        {
          featuredProjects.map((project, index) => {
            const startYear = project.data.startDate.getFullYear();
            const endYear = project.data.endDate ? project.data.endDate.getFullYear() : null;
            const period =
              endYear && endYear !== startYear ? `${startYear} - ${endYear}` : `${startYear}`;
            return (
              <ScrollReveal delay={100 + index * 150} client:idle>
                <ProjectCard
                  title={project.data.title}
                  description={project.data.description}
                  technologies={project.data.technologies.slice(0, 5)}
                  period={period}
                  status={statusMap[project.data.status]}
                  repositoryUrl={project.data.githubUrl}
                  demoUrl={project.data.liveUrl}
                  client:idle
                />
              </ScrollReveal>
            );
          })
        }
      </div>

      <ScrollReveal delay={500} client:idle>
        <div class="flex justify-center">
          <a
            href="/en/projects"
            class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-500 text-white rounded-lg font-medium hover:from-primary-500 hover:to-primary-400 transition-all hover:scale-105 shadow-lg hover:shadow-primary-500/50"
          >
            View all projects
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </a>
        </div>
      </ScrollReveal>
    </div>
  </ParallaxBackground>

  {/* Skills Section with Grid Pattern */}
  <ParallaxBackground speed={0.2} variant="grid" className="py-24 bg-neutral-950/50" client:idle>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <ScrollReveal delay={0} client:idle>
        <h2
          class="text-4xl font-bold text-center mb-4 bg-gradient-to-r from-primary-400 to-purple-500 gradient-text"
        >
          Technical Skills
        </h2>
        <p class="text-center text-neutral-400 mb-12 max-w-2xl mx-auto">
          Technologies and tools I master to create high-performance solutions
        </p>
      </ScrollReveal>

      {/* Skill categories preview */}
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-12">
        {
          skills.slice(0, 5).map((cat, index) => (
            <ScrollReveal delay={100 + index * 100} client:idle>
              <div class="glass-effect rounded-xl p-4 text-center hover:border-primary-400/20 border border-transparent transition-all duration-300">
                <p class="text-2xl font-bold text-neutral-100 mb-1">{cat.skills.length}</p>
                <p class="text-xs text-neutral-400 leading-tight">{cat.category}</p>
              </div>
            </ScrollReveal>
          ))
        }
      </div>

      <ScrollReveal delay={600} client:idle>
        <div class="flex justify-center">
          <a
            href="/en/skills"
            class="inline-flex items-center gap-2 px-6 py-3 border-2 border-neutral-700 text-neutral-200 rounded-lg font-medium hover:bg-neutral-800/50 hover:border-primary-500 transition-all backdrop-blur-sm"
          >
            Explore my skills
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
            </svg>
          </a>
        </div>
      </ScrollReveal>
    </div>
  </ParallaxBackground>
</Layout>
