---
/**
 * About Page EN
 * Dynamic data from Content Collections
 */
import { getEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Terminal from '../../components/Terminal';
import AnimatedCounter from '../../components/AnimatedCounter';
import Timeline from '../../components/Timeline';
import ScrollReveal from '../../components/ScrollReveal';
import ParallaxBackground from '../../components/ParallaxBackground';

export const prerender = true;

const lang = 'en' as const;

// Load real data from Content Collections
const certsEntry = await getEntry('certifications', 'certifications.en');
const skillsEntry = await getEntry('skills', 'skills.en');
const allProjects = await getCollection('projects');

const certs = certsEntry?.data ?? [];
const skills = skillsEntry?.data ?? [];
const enProjects = allProjects.filter((p) => p.id.endsWith('.en'));

// Dynamically computed stats
const totalSkills = skills.reduce((acc, cat) => acc + cat.skills.length, 0);
const totalCerts = certs.length;
const totalProjects = enProjects.length;
const totalCategories = skills.length;

// Terminal with real skills
const terminalLines = [
  { type: 'command' as const, content: 'whoami', delay: 500 },
  {
    type: 'output' as const,
    content: 'Esdras GBEDOZIN\nSoftware Engineer â€” Full-Stack & Cloud',
    delay: 100,
  },
  { type: 'command' as const, content: 'cat skills.txt', delay: 800 },
  {
    type: 'output' as const,
    content: `â˜ï¸  Cloud: GCP, Cloud Run, Firestore, Terraform\nðŸ”§ Backend: Python, FastAPI, Flask, Java, Node.js\nâœ¨ Frontend: React, TypeScript, Astro, Tailwind CSS\nðŸ“Š DevOps: Docker, Jenkins, GitHub Actions, CI/CD\nðŸ§ª Testing: Playwright, Selenium, Cypress, PyTest, TDD\nðŸ¤– AI: Vertex AI, Gemini API, Document AI`,
    delay: 100,
  },
  { type: 'command' as const, content: 'echo $PASSION', delay: 1000 },
  {
    type: 'output' as const,
    content: 'ðŸš€ Architecting robust and scalable cloud-native solutions',
    delay: 100,
  },
];

// Timeline built from real certifications
const timelineItems = certs
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .map((cert) => ({
    title: cert.title,
    date: new Date(cert.date).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
    }),
    description: cert.description ?? `Certification issued by ${cert.organization}`,
    type: 'certification' as const,
  }));
---

<Layout
  title="About - Portfolio"
  description="About Esdras GBEDOZIN â€” Software Engineer specializing in Cloud, DevOps and Full-Stack development. Journey, certifications and technical expertise."
  lang={lang}
>
  {/* Hero Section */}
  <ParallaxBackground speed={0.3} variant="gradient" className="py-24" client:idle>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <ScrollReveal delay={0} client:idle>
        <h1
          class="text-5xl md:text-6xl font-bold text-center mb-6 bg-gradient-to-r from-primary-400 via-purple-500 to-primary-400 gradient-text bg-[length:200%_100%] animate-gradient-text"
        >
          About Me
        </h1>
        <p class="text-xl text-center text-neutral-400 max-w-3xl mx-auto leading-relaxed">
          Software engineer passionate about cloud architecture, DevOps and Full-Stack development.
          I design robust cloud-native solutions with Python, React and Google Cloud Platform.
        </p>
      </ScrollReveal>
    </div>
  </ParallaxBackground>

  {/* Stats Section â€” dynamic data */}
  <section class="py-16 bg-neutral-950/50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
        <AnimatedCounter
          end={totalProjects}
          suffix="+"
          label="Projects delivered"
          duration={2}
          client:idle
        />
        <AnimatedCounter end={totalCerts} label="Certifications" duration={2} client:idle />
        <AnimatedCounter
          end={totalSkills}
          suffix="+"
          label="Technologies mastered"
          duration={2.5}
          client:idle
        />
        <AnimatedCounter
          end={totalCategories}
          label="Areas of expertise"
          duration={2}
          client:idle
        />
      </div>
    </div>
  </section>

  {/* Terminal Section */}
  <ParallaxBackground speed={0.2} variant="dots" className="py-24" client:idle>
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <ScrollReveal delay={0} client:idle>
        <h2
          class="text-4xl font-bold text-center mb-12 bg-gradient-to-r from-primary-400 to-purple-500 gradient-text"
        >
          ~/my-profile
        </h2>
      </ScrollReveal>

      <ScrollReveal delay={200} client:idle>
        <Terminal lines={terminalLines} prompt="â¯" client:idle />
      </ScrollReveal>
    </div>
  </ParallaxBackground>

  {/* Timeline Section â€” real certifications */}
  <section class="py-24 bg-neutral-950/50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <ScrollReveal delay={0} client:idle>
        <h2
          class="text-4xl font-bold text-center mb-4 bg-gradient-to-r from-primary-400 to-purple-500 gradient-text"
        >
          My Journey
        </h2>
        <p class="text-center text-neutral-400 mb-16 max-w-2xl mx-auto">
          Certifications and professional achievements
        </p>
      </ScrollReveal>

      <Timeline items={timelineItems} linePosition="left" client:idle />
    </div>
  </section>

  {/* CTA Section */}
  <ParallaxBackground speed={0.3} variant="gradient" className="py-24" client:idle>
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <ScrollReveal delay={0} client:idle>
        <h2 class="text-4xl font-bold mb-6 text-neutral-100">Let's Work Together</h2>
        <p class="text-xl text-neutral-400 mb-8 max-w-2xl mx-auto">
          Have an ambitious project? Let's discuss how I can help you achieve it.
        </p>
        <a
          href="/en/contact"
          class="inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-primary-600 to-primary-500 text-white rounded-lg font-medium hover:from-primary-500 hover:to-primary-400 transition-all hover:scale-105 shadow-lg hover:shadow-primary-500/50 text-lg"
        >
          Contact Me
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </ScrollReveal>
    </div>
  </ParallaxBackground>
</Layout>
