Run pnpm test

> proto-point@0.0.1 test /home/runner/work/MyPortfolio/MyPortfolio
> vitest run


 RUN  v4.0.18 /home/runner/work/MyPortfolio/MyPortfolio

 ✓ src/errors/ApiError.test.ts (17 tests) 20ms
stderr | tests/api/contact.json.errors.test.ts
[Sentry] SENTRY_DSN not configured. Error tracking disabled.

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-033: Validation error (400) > should return 400 with RFC 7807 format when validation fails
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: '3fd500b5-f71a-4b4b-89a1-877ed464acc4',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-033: Validation error (400) > should return 400 with RFC 7807 format when validation fails
[WARN] API error occurred {
  context: 'api/contact',
  requestId: '3fd500b5-f71a-4b4b-89a1-877ed464acc4',
  errorType: 'ValidationError',
  status: 400
}

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-035: Turnstile error (403) > should return 403 with RFC 7807 format when Turnstile verification fails
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: '566aef69-c1be-4c94-a9de-643404126d86',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-035: Turnstile error (403) > should return 403 with RFC 7807 format when Turnstile verification fails
[WARN] API error occurred {
  context: 'api/contact',
  requestId: '566aef69-c1be-4c94-a9de-643404126d86',
  errorType: 'TurnstileError',
  status: 403
}

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-037: Rate limit error (429) > should return 429 with Retry-After header when rate limit exceeded
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: 'a3486e18-2b2a-4bef-b6ab-bb10c7fe9643',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-037: Rate limit error (429) > should return 429 with Retry-After header when rate limit exceeded
[WARN] API error occurred {
  context: 'api/contact',
  requestId: 'a3486e18-2b2a-4bef-b6ab-bb10c7fe9643',
  errorType: 'RateLimitError',
  status: 429
}

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-039: Email sending error (500) > should return 500 with RFC 7807 format when email sending fails
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: 'd1bbb440-9607-4bae-bf70-5cf2ad3f543c',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-039: Email sending error (500) > should return 500 with RFC 7807 format when email sending fails
[WARN] API error occurred {
  context: 'api/contact',
  requestId: 'd1bbb440-9607-4bae-bf70-5cf2ad3f543c',
  errorType: 'EmailError',
  status: 500
}

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-040: Internal server error (500) > should return 500 with RFC 7807 format for unexpected errors
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: '45c1bfdd-4607-4248-8863-dc9c69b0748e',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.errors.test.ts > POST /api/contact - Epic 3.2 Error Handling > EF-040: Internal server error (500) > should return 500 with RFC 7807 format for unexpected errors
[ERROR] Unexpected error in POST /api/contact {
  context: 'api/contact',
  requestId: '45c1bfdd-4607-4248-8863-dc9c69b0748e',
  error: {
    name: 'Error',
    message: 'Unexpected database error',
    stack: 'Error: Unexpected database error\n' +
      '    at /home/runner/work/MyPortfolio/MyPortfolio/tests/api/contact.json.errors.test.ts:215:51\n' +
      '    at file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/@vitest+runner@4.0.18/node_modules/@vitest/runner/dist/index.js:145:11\n' +
      '    at file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/@vitest+runner@4.0.18/node_modules/@vitest/runner/dist/index.js:915:26\n' +
      '    at file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/@vitest+runner@4.0.18/node_modules/@vitest/runner/dist/index.js:1243:20\n' +
      '    at new Promise (<anonymous>)\n' +
      '    at runWithTimeout (file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/@vitest+runner@4.0.18/node_modules/@vitest/runner/dist/index.js:1209:10)\n' +
      '    at file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/@vitest+runner@4.0.18/node_modules/@vitest/runner/dist/index.js:1653:37\n' +
      '    at Traces.$ (file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/vitest@4.0.18_@opentelemetry+api@1.9.0_@types+node@25.0.9_@vitest+ui@4.0.18_jiti@2.6.1__66732c09b38ae0d412758bf429f9a2bf/node_modules/vitest/dist/chunks/traces.CCmnQaNT.js:142:27)\n' +
      '    at trace (file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/vitest@4.0.18_@opentelemetry+api@1.9.0_@types+node@25.0.9_@vitest+ui@4.0.18_jiti@2.6.1__66732c09b38ae0d412758bf429f9a2bf/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n' +
      '    at runTest (file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/@vitest+runner@4.0.18/node_modules/@vitest/runner/dist/index.js:1653:12)'
  }
}

 ✓ tests/api/contact.json.errors.test.ts (5 tests) 29ms
 ✓ src/services/contactValidation.test.ts (19 tests) 14ms
 ✓ src/services/api.test.ts (9 tests) 15ms
 ✓ src/components/ThemeToggle.test.tsx (11 tests) 433ms
 ✓ src/services/email/ResendEmailService.test.ts (12 tests) 24ms
 ✓ src/services/TurnstileService.test.ts (11 tests) 14ms
 ✓ src/components/ProjectFilter.test.tsx (10 tests) 802ms
     ✓ should render All button  310ms
stderr | tests/api/contact.json.test.ts
[Sentry] SENTRY_DSN not configured. Error tracking disabled.

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should return 200 when all services succeed
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: 'b4fd9c44-abbd-42ff-8662-2328b946255a',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should return 200 when all services succeed
[INFO] Contact form processed successfully {
  context: 'api/contact',
  requestId: 'b4fd9c44-abbd-42ff-8662-2328b946255a',
  email: 'john@example.com'
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should call ContactService to process request
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: '9a1b3482-d555-4a62-97a2-6b9c590a5408',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should call ContactService to process request
[INFO] Contact form processed successfully {
  context: 'api/contact',
  requestId: '9a1b3482-d555-4a62-97a2-6b9c590a5408',
  email: 'john@example.com'
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should call TurnstileService to verify token
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: 'c22b2ec8-9796-4a49-8f38-40a1fd7c9f52',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should call TurnstileService to verify token
[INFO] Contact form processed successfully {
  context: 'api/contact',
  requestId: 'c22b2ec8-9796-4a49-8f38-40a1fd7c9f52',
  email: 'john@example.com'
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should call RateLimitService to check IP rate limit
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: 'a2a2c5dd-eb12-4a48-9922-a72a1c7f441b',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should call RateLimitService to check IP rate limit
[INFO] Contact form processed successfully {
  context: 'api/contact',
  requestId: 'a2a2c5dd-eb12-4a48-9922-a72a1c7f441b',
  email: 'john@example.com'
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should call EmailService to send email
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: '9e644b8e-26c8-4493-971f-111a255bf2d6',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > EF-030: Cas nominal (200 OK) > should call EmailService to send email
[INFO] Contact form processed successfully {
  context: 'api/contact',
  requestId: '9e644b8e-26c8-4493-971f-111a255bf2d6',
  email: 'john@example.com'
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > Content-Type validation > should handle missing content-type gracefully
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: '29c5bb0c-d273-42d0-8eaa-0d33fad0f849',
  clientIp: '192.168.1.1',
  hasName: true,
  hasEmail: true
}

stdout | tests/api/contact.json.test.ts > POST /api/contact - Epic 3.1 > Content-Type validation > should handle missing content-type gracefully
[INFO] Contact form processed successfully {
  context: 'api/contact',
  requestId: '29c5bb0c-d273-42d0-8eaa-0d33fad0f849',
  email: 'john@example.com'
}

 ✓ tests/api/contact.json.test.ts (6 tests) 24ms
 ✓ src/utils/logger.test.ts (9 tests) 19ms
 ✓ src/services/RateLimitService.test.ts (10 tests) 11ms
 ✓ src/components/Badge.test.tsx (18 tests) 231ms
 ❯ src/components/ContactForm.test.tsx (16 tests | 1 failed) 7922ms
     ✓ should render form with name, email and message fields 263ms
     ✓ should show required error when name is empty 81ms
     ✓ should show required error when email is empty 57ms
     ✓ should show invalid email format error 234ms
     ✓ should show required error when message is empty 53ms
     ✓ should show error when name exceeds max length (100 chars)  329ms
     × should show error when message exceeds max length (2000 chars) 5016ms
     ✓ should accept valid form data 293ms
     ✓ should clear errors when user corrects input 295ms
     ✓ should call onSuccess callback when API responds successfully 191ms
     ✓ should call onError callback when API returns an error 205ms
     ✓ should show loading state during form submission 206ms
     ✓ should show success message after successful submission 213ms
     ✓ should show error message after failed submission 157ms
     ✓ should allow retry after error 180ms
     ✓ should disable all form fields during submission 148ms
 ✓ src/components/LanguageSwitcher.test.tsx (11 tests) 442ms
 ✓ tests/api/health.test.ts (6 tests) 29ms
stderr | tests/api/contact.json.requestId.test.ts
[Sentry] SENTRY_DSN not configured. Error tracking disabled.

 ✓ tests/api/contact.json.requestId.test.ts (3 tests) 8ms
stdout | tests/api/contact.json.sentry.test.ts > POST /api/contact - Sentry Integration > should capture exception in Sentry when unexpected error occurs
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: '36dc0156-c8e2-4e40-a14a-505b54fb3bf2',
  clientIp: '192.168.1.100',
  hasName: false,
  hasEmail: false
}
Error: [ERROR] Unexpected error in POST /api/contact {
  context: 'api/contact',
  requestId: '36dc0156-c8e2-4e40-a14a-505b54fb3bf2',
  error: {
    name: 'Error',
    message: 'Turnstile secret key is required',
    stack: 'Error: Turnstile secret key is required\n' +
      '    at new TurnstileService (/home/runner/work/MyPortfolio/MyPortfolio/src/services/TurnstileService.ts:65:13)\n' +
      '    at new ContactService (/home/runner/work/MyPortfolio/MyPortfolio/src/services/ContactService.ts:49:29)\n' +
      '    at POST (/home/runner/work/MyPortfolio/MyPortfolio/src/pages/api/contact.ts:80:28)\n' +
      '    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
      '    at /home/runner/work/MyPortfolio/MyPortfolio/tests/api/contact.json.sentry.test.ts:55:22\n' +
      '    at file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/@vitest+runner@4.0.18/node_modules/@vitest/runner/dist/index.js:915:20'
  }
}

stdout | tests/api/contact.json.sentry.test.ts > POST /api/contact - Sentry Integration > should set Sentry context with requestId and IP
[INFO] Contact form submission received {
  context: 'api/contact',
  requestId: 'a9b1027c-3f3d-4a16-a425-d130e6ad2178',
  clientIp: '192.168.1.100',
  hasName: false,
  hasEmail: false
}
Error: [ERROR] Unexpected error in POST /api/contact {
  context: 'api/contact',
  requestId: 'a9b1027c-3f3d-4a16-a425-d130e6ad2178',
  error: {
    name: 'Error',
    message: 'Turnstile secret key is required',
    stack: 'Error: Turnstile secret key is required\n' +
      '    at new TurnstileService (/home/runner/work/MyPortfolio/MyPortfolio/src/services/TurnstileService.ts:65:13)\n' +
      '    at new ContactService (/home/runner/work/MyPortfolio/MyPortfolio/src/services/ContactService.ts:49:29)\n' +
      '    at POST (/home/runner/work/MyPortfolio/MyPortfolio/src/pages/api/contact.ts:80:28)\n' +
      '    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
      '    at /home/runner/work/MyPortfolio/MyPortfolio/tests/api/contact.json.sentry.test.ts:84:5\n' +
      '    at file:///home/runner/work/MyPortfolio/MyPortfolio/node_modules/.pnpm/@vitest+runner@4.0.18/node_modules/@vitest/runner/dist/index.js:915:20'
  }
}

 ✓ tests/api/contact.json.sentry.test.ts (3 tests | 1 skipped) 244ms
 ✓ src/components/ProjectCard.test.tsx (14 tests) 442ms
 ✓ src/utils/applySecurityHeaders.test.ts (8 tests) 14ms
 ✓ src/components/Hero.test.tsx (9 tests) 366ms
 ✓ src/components/SwaggerUI.test.tsx (9 tests) 76ms
 ✓ src/utils/i18n.test.ts (14 tests) 6ms
 ✓ src/utils/validateEnv.test.ts (9 tests) 11ms
 ✓ src/services/__mocks__/MockAntiSpamService.test.ts (7 tests) 82ms
 ✓ src/components/ScrollReveal.test.tsx (6 tests) 65ms
 ✓ src/utils/intl.test.ts (9 tests) 29ms
stderr | src/services/email/EmailServiceFactory.test.ts > createEmailService > should create SendGrid service when specified
API key does not start with "SG.".

 ✓ src/services/email/EmailServiceFactory.test.ts (8 tests) 374ms
     ✓ should use exponential backoff  302ms
 ✓ src/components/ParticlesBackground.test.tsx (5 tests) 23ms

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  src/components/ContactForm.test.tsx > ContactForm - Epic 6.2 FE-078 > should show error when message exceeds max length (2000 chars)
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 ❯ src/components/ContactForm.test.tsx:95:3
     93|   });
     94| 
     95|   it('should show error when message exceeds max length (2000 chars)',…
       |   ^
     96|     const user = userEvent.setup();
     97|     render(<ContactForm />);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯


 Test Files  1 failed | 27 passed (28)
      Tests  1 failed | 272 passed | 1 skipped (274)
   Start at  09:14:04
   Duration  15.92s (transform 1.03s, setup 2.27s, import 5.96s, tests 11.77s, environment 20.39s)


Error: Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 ❯ src/components/ContactForm.test.tsx:95:3


 ELIFECYCLE  Test failed. See above for more details.
Error: Process completed with exit code 1.